# é’±åŒ…è¿æ¥å¼€å‘æ­¥éª¤ä¸å­¦ä¹ ä»£ç 

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨React + Viteé¡¹ç›®ä¸­å®ç°MetaMaské’±åŒ…è¿æ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¼€å‘æ­¥éª¤ã€æ ¸å¿ƒä»£ç å’Œå­¦ä¹ è¦ç‚¹ã€‚

## å¼€å‘ç¯å¢ƒ

- React 19.2.0
- Vite 7.3.1
- Ethers.js 6.16.0
- React Router 7.12.0

## å¼€å‘æ­¥éª¤

### æ­¥éª¤1ï¼šå®‰è£…ä¾èµ–

é¦–å…ˆï¼Œéœ€è¦å®‰è£…Ethers.jsåº“ï¼Œç”¨äºä¸ä»¥å¤ªåŠé’±åŒ…äº¤äº’ï¼š

```bash
npm install ethers
```

### æ­¥éª¤2ï¼šåˆ›å»ºé’±åŒ…è¿æ¥ç»„ä»¶

åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„é’±åŒ…è¿æ¥æŒ‰é’®ç»„ä»¶ `WalletConnectButton.jsx`ï¼Œç”¨äºå¤„ç†é’±åŒ…è¿æ¥é€»è¾‘ï¼š

```jsx
import React from 'react';
import { ethers } from 'ethers';
import '../../styles/components/WalletConnectButton.css';

/**
 * è¿æ¥é’±åŒ…æŒ‰é’®ç»„ä»¶
 * å¤„ç†MetaMaské’±åŒ…è¿æ¥åŠŸèƒ½
 */
const WalletConnectButton = ({ onConnect, onDisconnect, walletConnected, walletAddress }) => {
  /**
   * è¿æ¥é’±åŒ…å‡½æ•°
   * ç›´æ¥ä½¿ç”¨window.ethereumå¯¹è±¡ä¸MetaMaskäº¤äº’
   */
  const connectWallet = async () => {
    try {
      console.log('å¼€å§‹è¿æ¥é’±åŒ…...');
      
      if (!window.ethereum) {
        console.log('æœªæ£€æµ‹åˆ°MetaMask');
        alert('è¯·å®‰è£…MetaMaské’±åŒ…');
        return;
      }

      console.log('æ£€æµ‹åˆ°MetaMaskï¼Œå‡†å¤‡è§¦å‘è¿æ¥è¯·æ±‚...');
      console.log('window.ethereumå¯¹è±¡:', window.ethereum);
      console.log('window.ethereumæ˜¯å¦æœ‰requestæ–¹æ³•:', typeof window.ethereum.request === 'function');
      
      // å¼ºåˆ¶è§¦å‘MetaMaskè¿æ¥è¯·æ±‚ï¼Œç¡®ä¿å¼¹å‡ºç¡®è®¤çª—å£
      const accounts = await window.ethereum.request({
        method: 'eth_requestAccounts'
      });
      
      console.log('è¿æ¥è¯·æ±‚æˆåŠŸï¼Œè¿”å›çš„è´¦æˆ·:', accounts);
      
      const address = accounts[0];
      
      console.log('é’±åŒ…è¿æ¥æˆåŠŸ:', address);
      
      // è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥çˆ¶ç»„ä»¶
      if (onConnect) {
        onConnect(address);
      }
    } catch (error) {
      console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
      alert('è¿æ¥é’±åŒ…å¤±è´¥ï¼Œè¯·é‡è¯•');
    }
  };

  /**
   * æ–­å¼€é’±åŒ…è¿æ¥
   */
  const disconnectWallet = () => {
    console.log('é’±åŒ…å·²æ–­å¼€è¿æ¥');
    
    // è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥çˆ¶ç»„ä»¶
    if (onDisconnect) {
      onDisconnect();
    }
  };

  /**
   * æ ¼å¼åŒ–é’±åŒ…åœ°å€ï¼Œåªæ˜¾ç¤ºå‰6ä½å’Œå4ä½
   */
  const formatWalletAddress = (address) => {
    if (!address) return '';
    return `${address.slice(0, 6)}...${address.slice(-4)}`;
  };

  return (
    <>
      {!walletConnected ? (
        <div className="wallet-connect-options">
          <button 
            className="wallet-connect-btn meta-mask-btn"
            onClick={connectWallet}
          >
            Connect with MetaMask
          </button>
          <button 
            className="wallet-connect-btn brave-wallet-btn"
            onClick={connectWallet}
          >
            Connect with Brave Wallet
          </button>
        </div>
      ) : (
        <div className="wallet-connected-info">
          <span className="wallet-address">{formatWalletAddress(walletAddress)}</span>
          <button 
            className="disconnect-btn"
            onClick={disconnectWallet}
          >
            Disconnect
          </button>
        </div>
      )}
    </>
  );
};

export default WalletConnectButton;
```

### æ­¥éª¤3ï¼šæ·»åŠ æ ·å¼

åˆ›å»º `WalletConnectButton.css` æ–‡ä»¶ï¼Œä¸ºé’±åŒ…è¿æ¥æŒ‰é’®æ·»åŠ æ ·å¼ï¼š

```css
/* é’±åŒ…è¿æ¥æŒ‰é’®æ ·å¼ */

/* é’±åŒ…è¿æ¥é€‰é¡¹å®¹å™¨ */
.wallet-connect-options {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  width: 100%;
  max-width: 300px;
}

/* é’±åŒ…è¿æ¥æŒ‰é’®åŸºç¡€æ ·å¼ */
.wallet-connect-btn {
  width: 100%;
  padding: 0.875rem 1.5rem;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 600;
  color: #ffffff;
  cursor: pointer;
  transition: all 0.3s ease-in-out;
  position: relative;
  overflow: hidden;
  text-align: center;
}

/* MetaMaskæŒ‰é’®æ ·å¼ */
.meta-mask-btn {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.meta-mask-btn:hover {
  background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

/* Brave WalletæŒ‰é’®æ ·å¼ */
.brave-wallet-btn {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.brave-wallet-btn:hover {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
}

/* é’±åŒ…å·²è¿æ¥çŠ¶æ€ */
.wallet-connected-info {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background-color: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
}

/* é’±åŒ…åœ°å€æ˜¾ç¤º */
.wallet-address {
  font-size: 0.875rem;
  font-weight: 500;
  color: #1a1a2e;
  flex: 1;
}

/* æ–­å¼€è¿æ¥æŒ‰é’® */
.disconnect-btn {
  padding: 0.5rem 1rem;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  background-color: #ffffff;
  font-size: 0.75rem;
  font-weight: 500;
  color: #64748b;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.disconnect-btn:hover {
  background-color: #f8fafc;
  color: #1a1a2e;
  border-color: #cbd5e1;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .wallet-connect-options {
    max-width: 100%;
  }

  .wallet-connect-btn {
    padding: 0.75rem 1.25rem;
    font-size: 0.875rem;
  }

  .wallet-connected-info {
    flex-direction: column;
    align-items: stretch;
    gap: 0.75rem;
  }

  .wallet-address {
    text-align: center;
  }

  .disconnect-btn {
    width: 100%;
  }
}
```

### æ­¥éª¤4ï¼šåœ¨é¡µé¢ä¸­ä½¿ç”¨é’±åŒ…è¿æ¥ç»„ä»¶

åœ¨éœ€è¦é’±åŒ…è¿æ¥åŠŸèƒ½çš„é¡µé¢ä¸­ï¼Œä¾‹å¦‚ `Portfolio.jsx`ï¼Œæ·»åŠ é’±åŒ…è¿æ¥çŠ¶æ€ç®¡ç†å’Œä½¿ç”¨ `WalletConnectButton` ç»„ä»¶ï¼š

```jsx
import React, { useState, useEffect } from 'react';
import { ethers } from 'ethers';
import '../styles/pages/Portfolio.css';
import WalletConnectButton from '../components/ui/WalletConnectButton';
import EtfCard from '../components/ui/EtfCard';

/**
 * æŠ•èµ„ç»„åˆé¡µé¢ç»„ä»¶
 * å±•ç¤ºç”¨æˆ·çš„ETFæŠ•èµ„ç»„åˆå’Œç›¸å…³ç»Ÿè®¡ä¿¡æ¯
 */
const Portfolio = () => {
  const [walletConnected, setWalletConnected] = useState(false);
  const [walletAddress, setWalletAddress] = useState(null);

  // æ¨¡æ‹ŸETFæ•°æ®
  const etfData = [
    {
      id: 1,
      name: 'DeFiè“ç­¹ETF',
      symbol: 'DEFI-BLUE',
      price: 125.50,
      change: 2.34,
      changePercent: 1.90,
      holdings: 15.25,
      totalValue: 1911.88,
      logo: 'ğŸ“Š'
    },
    {
      id: 2,
      name: 'NFTç²¾é€‰ETF',
      symbol: 'NFT-SELECT',
      price: 89.75,
      change: -1.20,
      changePercent: -1.32,
      holdings: 8.50,
      totalValue: 762.88,
      logo: 'ğŸ¨'
    },
    {
      id: 3,
      name: 'Layer 1å…¬é“¾ETF',
      symbol: 'L1-COINS',
      price: 156.20,
      change: 5.67,
      changePercent: 3.78,
      holdings: 10.00,
      totalValue: 1562.00,
      logo: 'ğŸ”—'
    },
    {
      id: 4,
      name: 'Web3åŸºç¡€è®¾æ–½ETF',
      symbol: 'WEB3-INFRA',
      price: 98.45,
      change: 0.89,
      changePercent: 0.91,
      holdings: 12.75,
      totalValue: 1255.24,
      logo: 'ğŸ—ï¸'
    }
  ];

  // ç›‘å¬é’±åŒ…è¿æ¥çŠ¶æ€å˜åŒ–
  useEffect(() => {
    if (window.ethereum) {
      // ç›‘å¬è´¦å·å˜åŒ–
      window.ethereum.on('accountsChanged', async (accounts) => {
        if (accounts.length > 0) {
          setWalletConnected(true);
          setWalletAddress(accounts[0]);
        } else {
          setWalletConnected(false);
          setWalletAddress(null);
        }
      });

      // ç›‘å¬é“¾å˜åŒ–
      window.ethereum.on('chainChanged', () => {
        // é“¾å˜åŒ–æ—¶ï¼Œé‡ç½®è¿æ¥çŠ¶æ€
        setWalletConnected(false);
        setWalletAddress(null);
      });
    }
  }, []);

  // æ¨¡æ‹ŸETHèµ„äº§æ•°æ®
  const ethBalance = {
    amount: 0.5,
    value: 1250.00
  };

  // è®¡ç®—æŠ•èµ„ç»„åˆæ€»ä»·å€¼ï¼ˆåŒ…å«ETHï¼‰
  const totalPortfolioValue = etfData.reduce((total, etf) => total + etf.totalValue, 0) + ethBalance.value;

  // è®¡ç®—æ€»æ”¶ç›Š
  const totalReturns = etfData.reduce((total, etf) => {
    const costBasis = (etf.price - etf.change) * etf.holdings;
    return total + (etf.totalValue - costBasis);
  }, 0);

  // å¤„ç†é’±åŒ…è¿æ¥æˆåŠŸçš„å›è°ƒ
  const handleWalletConnect = (address) => {
    setWalletConnected(true);
    setWalletAddress(address);
  };

  // å¤„ç†é’±åŒ…æ–­å¼€è¿æ¥çš„å›è°ƒ
  const handleWalletDisconnect = () => {
    setWalletConnected(false);
    setWalletAddress(null);
  };

  return (
    <div className="portfolio-container">
      {/* ç½‘ç«™æ ‡è¯­å’Œä»‹ç» */}
      <div className="website-intro">
        <h1 className="intro-title">LEAPETF</h1>
        <p className="intro-subtitle">å»ä¸­å¿ƒåŒ–åŒºå—é“¾ETFäº¤æ˜“å¹³å°</p>
      </div>

      {/* é’±åŒ…è¿æ¥æç¤º */}
      {!walletConnected && (
        <div className="wallet-prompt">
          <div className="wallet-prompt-content">
            <h2 className="prompt-title">Welcome to LeapETF</h2>
            <p className="prompt-message">A decentralized platform for trading blockchain-based ETFs</p>
            <p className="prompt-submessage">Connect your wallet to start trading</p>
            <WalletConnectButton 
              onConnect={handleWalletConnect} 
              onDisconnect={handleWalletDisconnect} 
              walletConnected={walletConnected} 
              walletAddress={walletAddress} 
            />
          </div>
        </div>
      )}

      {/* æŠ•èµ„ç»„åˆå†…å®¹ - ä»…åœ¨é’±åŒ…è¿æ¥åæ˜¾ç¤º */}
      {walletConnected && (
        <>
          <div className="portfolio-header">
            <div className="portfolio-title">
              <h1>æˆ‘çš„æŠ•èµ„ç»„åˆ</h1>
            </div>
            <div className="portfolio-actions">
              <WalletConnectButton 
                onConnect={handleWalletConnect} 
                onDisconnect={handleWalletDisconnect} 
                walletConnected={walletConnected} 
                walletAddress={walletAddress} 
              />
            </div>
          </div>

          <div className="portfolio-summary">
            <div className="summary-card">
              <div className="summary-title">æ€»ä»·å€¼</div>
              <div className="summary-value">${totalPortfolioValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
            </div>
            <div className="summary-card">
              <div className="summary-title">æ€»æ”¶ç›Š</div>
              <div className={`summary-value ${totalReturns >= 0 ? 'positive' : 'negative'}`}>
                ${Math.abs(totalReturns).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                <span className="summary-change">{totalReturns >= 0 ? '+' : ''}{(totalReturns / totalPortfolioValue * 100).toFixed(2)}%</span>
              </div>
            </div>
            <div className="summary-card">
              <div className="summary-title">æŒæœ‰ETFæ•°é‡</div>
              <div className="summary-value">{etfData.length}</div>
            </div>
          </div>

          <div className="portfolio-content">
            {/* ETHèµ„äº§æ˜¾ç¤º */}
            <div className="portfolio-section">
              <h2>æˆ‘çš„èµ„äº§</h2>
              <div className="asset-cards-grid">
                <div className="asset-card eth-card">
                  <div className="asset-header">
                    <div className="asset-icon">Î</div>
                    <div className="asset-info">
                      <div className="asset-name">Ethereum</div>
                      <div className="asset-symbol">ETH</div>
                    </div>
                  </div>
                  <div className="asset-balance">
                    <div className="balance-amount">{ethBalance.amount} ETH</div>
                    <div className="balance-value">${ethBalance.value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* ETFæŒä»“æ˜¾ç¤º */}
            <div className="portfolio-section">
              <h2>æˆ‘çš„ETFæŒä»“</h2>
              <div className="eta-cards-grid">
                {etfData.map(etf => (
                  <EtfCard key={etf.id} eta={etf} />
                ))}
              </div>
            </div>
          </div>
        </>
      )}
    </div>
  );
};

export default Portfolio;
```

### æ­¥éª¤5ï¼šæ·»åŠ é¡µé¢æ ·å¼

ä¸ºé¡µé¢æ·»åŠ æ ·å¼ï¼Œç¡®ä¿é’±åŒ…è¿æ¥æç¤ºå’Œèµ„äº§æ˜¾ç¤ºæ­£å¸¸ï¼š

```css
/* Portfolioé¡µé¢æ ·å¼ */

/* é¡µé¢å®¹å™¨ */
.portfolio-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  font-family: 'Arial', sans-serif;
}

/* ç½‘ç«™æ ‡è¯­å’Œä»‹ç» */
.website-intro {
  text-align: center;
  margin-bottom: 3rem;
}

.intro-title {
  font-size: 2.5rem;
  font-weight: 700;
  color: #1a1a2e;
  margin-bottom: 0.5rem;
}

.intro-subtitle {
  font-size: 1.2rem;
  color: #64748b;
  margin-top: 0;
}

/* é’±åŒ…è¿æ¥æç¤º */
.wallet-prompt {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 60vh;
}

.wallet-prompt-content {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  padding: 3rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  text-align: center;
  max-width: 500px;
  width: 100%;
}

.prompt-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1a1a2e;
  margin-bottom: 1rem;
}

.prompt-message {
  font-size: 1.1rem;
  color: #64748b;
  margin-bottom: 2rem;
}

.prompt-submessage {
  font-size: 1rem;
  color: #94a3b8;
  margin-bottom: 3rem;
}

/* æŠ•èµ„ç»„åˆå¤´éƒ¨ */
.portfolio-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
}

.portfolio-title h1 {
  font-size: 2rem;
  font-weight: 700;
  color: #1a1a2e;
  margin: 0;
}

.portfolio-actions {
  display: flex;
  gap: 1rem;
}

/* æŠ•èµ„ç»„åˆæ‘˜è¦ */
.portfolio-summary {
  display: flex;
  gap: 1.5rem;
  margin-bottom: 3rem;
  flex-wrap: wrap;
}

.summary-card {
  flex: 1;
  min-width: 250px;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.summary-title {
  font-size: 0.9rem;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 0.5rem;
}

.summary-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: #1a1a2e;
  margin: 0;
}

.summary-change {
  font-size: 0.9rem;
  font-weight: 500;
  margin-left: 0.5rem;
}

.positive {
  color: #10b981;
}

.negative {
  color: #ef4444;
}

/* æŠ•èµ„ç»„åˆå†…å®¹ */
.portfolio-content {
  display: flex;
  flex-direction: column;
  gap: 3rem;
}

/* æŠ•èµ„ç»„åˆéƒ¨åˆ† */
.portfolio-section {
  background-color: #ffffff;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.portfolio-section h2 {
  font-size: 1.4rem;
  font-weight: 600;
  color: #1a1a2e;
  margin-bottom: 1.5rem;
}

/* èµ„äº§å¡ç‰‡ç½‘æ ¼ */
.asset-cards-grid {
  display: flex;
  gap: 1.5rem;
  flex-wrap: wrap;
}

/* èµ„äº§å¡ç‰‡ */
.asset-card {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  min-width: 300px;
  flex: 1;
}

/* ETHå¡ç‰‡ */
.eth-card {
  background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
  color: #ffffff;
}

.asset-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.asset-icon {
  font-size: 2rem;
  font-weight: 700;
}

.asset-info {
  flex: 1;
}

.asset-name {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.asset-symbol {
  font-size: 0.9rem;
  opacity: 0.8;
}

.asset-balance {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.balance-amount {
  font-size: 1.8rem;
  font-weight: 700;
}

.balance-value {
  font-size: 1.1rem;
  opacity: 0.8;
}

/* ETFå¡ç‰‡ç½‘æ ¼ */
.eta-cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .portfolio-container {
    padding: 1rem;
  }

  .intro-title {
    font-size: 2rem;
  }

  .portfolio-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }

  .portfolio-summary {
    flex-direction: column;
  }

  .summary-card {
    width: 100%;
  }

  .asset-cards-grid {
    flex-direction: column;
  }

  .asset-card {
    width: 100%;
  }

  .eta-cards-grid {
    grid-template-columns: 1fr;
  }
}
```

## æ ¸å¿ƒä»£ç è§£æ

### 1. é’±åŒ…è¿æ¥å‡½æ•°

```jsx
const connectWallet = async () => {
  try {
    console.log('å¼€å§‹è¿æ¥é’±åŒ…...');
    
    if (!window.ethereum) {
      console.log('æœªæ£€æµ‹åˆ°MetaMask');
      alert('è¯·å®‰è£…MetaMaské’±åŒ…');
      return;
    }

    console.log('æ£€æµ‹åˆ°MetaMaskï¼Œå‡†å¤‡è§¦å‘è¿æ¥è¯·æ±‚...');
    
    // å¼ºåˆ¶è§¦å‘MetaMaskè¿æ¥è¯·æ±‚ï¼Œç¡®ä¿å¼¹å‡ºç¡®è®¤çª—å£
    const accounts = await window.ethereum.request({
      method: 'eth_requestAccounts'
    });
    
    console.log('è¿æ¥è¯·æ±‚æˆåŠŸï¼Œè¿”å›çš„è´¦æˆ·:', accounts);
    
    const address = accounts[0];
    
    console.log('é’±åŒ…è¿æ¥æˆåŠŸ:', address);
    
    // è°ƒç”¨å›è°ƒå‡½æ•°é€šçŸ¥çˆ¶ç»„ä»¶
    if (onConnect) {
      onConnect(address);
    }
  } catch (error) {
    console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
    alert('è¿æ¥é’±åŒ…å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};
```

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- ä½¿ç”¨ `window.ethereum.request({ method: 'eth_requestAccounts' })` æ¥è§¦å‘MetaMaskå¼¹å‡ºçª—å£ï¼Œè¿™æ˜¯å¼ºåˆ¶ç”¨æˆ·ç¡®è®¤è¿æ¥çš„å…³é”®
- æ£€æŸ¥ `window.ethereum` å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œä»¥ç¡®å®šMetaMaskæ˜¯å¦å·²å®‰è£…
- å¤„ç†è¿æ¥æˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µï¼Œå¹¶é€šè¿‡å›è°ƒå‡½æ•°é€šçŸ¥çˆ¶ç»„ä»¶

### 2. é’±åŒ…è¿æ¥çŠ¶æ€ç®¡ç†

```jsx
const [walletConnected, setWalletConnected] = useState(false);
const [walletAddress, setWalletAddress] = useState(null);

// ç›‘å¬é’±åŒ…è¿æ¥çŠ¶æ€å˜åŒ–
useEffect(() => {
  if (window.ethereum) {
    // ç›‘å¬è´¦å·å˜åŒ–
    window.ethereum.on('accountsChanged', async (accounts) => {
      if (accounts.length > 0) {
        setWalletConnected(true);
        setWalletAddress(accounts[0]);
      } else {
        setWalletConnected(false);
        setWalletAddress(null);
      }
    });

    // ç›‘å¬é“¾å˜åŒ–
    window.ethereum.on('chainChanged', () => {
      // é“¾å˜åŒ–æ—¶ï¼Œé‡ç½®è¿æ¥çŠ¶æ€
      setWalletConnected(false);
      setWalletAddress(null);
    });
  }
}, []);
```

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- ä½¿ç”¨ `useState` ç®¡ç†é’±åŒ…è¿æ¥çŠ¶æ€å’Œé’±åŒ…åœ°å€
- ä½¿ç”¨ `useEffect` ç›‘å¬é’±åŒ…çŠ¶æ€å˜åŒ–ï¼ŒåŒ…æ‹¬è´¦å·å˜åŒ–å’Œé“¾å˜åŒ–
- å½“é“¾å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡ç½®è¿æ¥çŠ¶æ€ï¼Œä»¥ç¡®ä¿ç”¨æˆ·é‡æ–°ç¡®è®¤è¿æ¥

### 3. é’±åŒ…è¿æ¥æŒ‰é’®ç»„ä»¶ä½¿ç”¨

```jsx
{!walletConnected && (
  <div className="wallet-prompt">
    <div className="wallet-prompt-content">
      <h2 className="prompt-title">Welcome to LeapETF</h2>
      <p className="prompt-message">A decentralized platform for trading blockchain-based ETFs</p>
      <p className="prompt-submessage">Connect your wallet to start trading</p>
      <WalletConnectButton 
        onConnect={handleWalletConnect} 
        onDisconnect={handleWalletDisconnect} 
        walletConnected={walletConnected} 
        walletAddress={walletAddress} 
      />
    </div>
  </div>
)}

{walletConnected && (
  <>
    <div className="portfolio-header">
      <div className="portfolio-title">
        <h1>æˆ‘çš„æŠ•èµ„ç»„åˆ</h1>
      </div>
      <div className="portfolio-actions">
        <WalletConnectButton 
          onConnect={handleWalletConnect} 
          onDisconnect={handleWalletDisconnect} 
          walletConnected={walletConnected} 
          walletAddress={walletAddress} 
        />
      </div>
    </div>
    {/* å…¶ä»–å†…å®¹ */}
  </>
)}
```

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- æ ¹æ®é’±åŒ…è¿æ¥çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„å†…å®¹
- å½“é’±åŒ…æœªè¿æ¥æ—¶ï¼Œæ˜¾ç¤ºè¿æ¥æç¤ºå’Œé’±åŒ…è¿æ¥æŒ‰é’®
- å½“é’±åŒ…å·²è¿æ¥æ—¶ï¼Œæ˜¾ç¤ºé¡µé¢å†…å®¹å’Œé’±åŒ…è¿æ¥çŠ¶æ€

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. MetaMaskæ²¡æœ‰å¼¹å‡ºç¡®è®¤çª—å£

**é—®é¢˜**ï¼šç‚¹å‡»è¿æ¥é’±åŒ…æŒ‰é’®åï¼ŒMetaMaskæ²¡æœ‰å¼¹å‡ºç¡®è®¤çª—å£ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ä½¿ç”¨ `window.ethereum.request({ method: 'eth_requestAccounts' })` è€Œä¸æ˜¯ `window.ethereum.selectedAddress` æˆ–å…¶ä»–æ–¹æ³•
- ç¡®ä¿åœ¨ç»„ä»¶åŠ è½½æ—¶ä¸è¦è‡ªåŠ¨æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´MetaMaskè®¤ä¸ºå·²ç»è¿æ¥
- æ£€æŸ¥MetaMaskæ˜¯å¦å·²ç»é”å®šï¼Œå¦‚æœæ˜¯ï¼Œè¯·è§£é”å®ƒ
- æ£€æŸ¥MetaMaskæ˜¯å¦å·²ç»è¿æ¥åˆ°å…¶ä»–ç½‘ç«™ï¼Œå¦‚æœæ˜¯ï¼Œè¯·å°è¯•æ–­å¼€è¿æ¥

### 2. é’±åŒ…è¿æ¥åé¡µé¢æ²¡æœ‰æ›´æ–°

**é—®é¢˜**ï¼šé’±åŒ…è¿æ¥æˆåŠŸåï¼Œé¡µé¢æ²¡æœ‰æ›´æ–°æ˜¾ç¤ºã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ­£ç¡®å®ç°äº† `onConnect` å›è°ƒå‡½æ•°ï¼Œæ›´æ–°é’±åŒ…è¿æ¥çŠ¶æ€
- ç¡®ä¿ç›‘å¬äº† `accountsChanged` äº‹ä»¶ï¼Œä»¥å“åº”é’±åŒ…çŠ¶æ€çš„å˜åŒ–

### 3. é“¾å˜åŒ–åé’±åŒ…è¿æ¥çŠ¶æ€æ²¡æœ‰æ›´æ–°

**é—®é¢˜**ï¼šå½“ç”¨æˆ·åœ¨MetaMaskä¸­åˆ‡æ¢ç½‘ç»œåï¼Œé’±åŒ…è¿æ¥çŠ¶æ€æ²¡æœ‰æ›´æ–°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç›‘å¬ `chainChanged` äº‹ä»¶ï¼Œå½“é“¾å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡ç½®è¿æ¥çŠ¶æ€

## å­¦ä¹ è¦ç‚¹

1. **Web3é’±åŒ…äº¤äº’åŸç†**ï¼šäº†è§£å¦‚ä½•é€šè¿‡ `window.ethereum` å¯¹è±¡ä¸MetaMaskç­‰é’±åŒ…äº¤äº’
2. **Ethers.jsåº“ä½¿ç”¨**ï¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨Ethers.jsåº“ä¸ä»¥å¤ªåŠåŒºå—é“¾äº¤äº’
3. **ReactçŠ¶æ€ç®¡ç†**ï¼šæŒæ¡å¦‚ä½•åœ¨Reactä¸­ç®¡ç†é’±åŒ…è¿æ¥çŠ¶æ€
4. **äº‹ä»¶ç›‘å¬**ï¼šäº†è§£å¦‚ä½•ç›‘å¬é’±åŒ…çŠ¶æ€å˜åŒ–äº‹ä»¶
5. **ç”¨æˆ·ä½“éªŒè®¾è®¡**ï¼šè®¾è®¡å‹å¥½çš„é’±åŒ…è¿æ¥æç¤ºå’ŒçŠ¶æ€æ˜¾ç¤º

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†MetaMaské’±åŒ…è¿æ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- åˆ›å»ºäº†ä¸“é—¨çš„é’±åŒ…è¿æ¥æŒ‰é’®ç»„ä»¶
- å®ç°äº†é’±åŒ…è¿æ¥é€»è¾‘ï¼Œç¡®ä¿ç‚¹å‡»æ—¶è§¦å‘MetaMaskå¼¹å‡ºçª—å£
- åœ¨é¡µé¢ä¸­ä½¿ç”¨é’±åŒ…è¿æ¥ç»„ä»¶ï¼Œç®¡ç†é’±åŒ…è¿æ¥çŠ¶æ€
- æ·»åŠ äº†å“åº”å¼æ ·å¼ï¼Œç¡®ä¿é¡µé¢åœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£å¸¸æ˜¾ç¤º

æ­¤å®ç°éµå¾ªäº†Web3é’±åŒ…è¿æ¥çš„æœ€ä½³å®è·µï¼Œç¡®ä¿äº†ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§ã€‚
